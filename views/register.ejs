<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0  shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/main.css" />
    <script>
      let eventid = "<%= eventid %>";
    </script>
    <title>Pulze</title>
  </head>
  <body>
    <nav class="navbar navbar-light bg-light">
      <a class="navbar-brand" href="/">
        <img width="30" height="30" alt="" />
      </a>
    </nav>
    <div class="container-fluid lay">
      <main id="content" class="bd-masthead" role="main">
        <div class="container">
          <div class="row">
            <div class="col-md-12 order-md-1 pr-md-5 text-center">
              <div class="registerhead">
                <b><u>Register for Upcoming Giveaway:</u></b>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 order-md-1 pr-md-5">
              <div class="eventbox">
                <div class="row">
                  <div class="col-md-12 order-md-1 pr-md-5">
                    <span>
                      <h5>
                        <b>Place:&nbsp;</b
                        ><span id="location">Tan Tock Seng Hospital</span>
                      </h5>
                    </span>
                  </div>
                  <div class="col-md-12 order-md-1 pr-md-5">
                    <span>
                      <h5>
                        <b>Date:&nbsp;</b><span id="date">June 2020</span>
                      </h5>
                    </span>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12 order-md-1 pr-md-5 text-center">
                    <h3
                      style="
                        color: #1a9cf3;
                        font-size: 22px;
                        letter-spacing: -0.5px;
                        font-family: Arial, Helvetica, sans-serif;
                      "
                      id="event_detail"
                    >
                      100 lunch sets of <b>Fried Chicken</b> will be given away.
                    </h3>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12 order-md-1 pr-md-5">
                    <span>
                      <h6 style="font-family: Visby CF Medium;">
                        <strong><u>Sponsored by</u></strong>
                      </h6>
                    </span>
                  </div>
                </div>
                <div class="row">
                  <div
                    class="col-md-2 order-md-1 pr-md-1"
                    style="padding-left: 3%;"
                  >
                    <img width="70px" height="auto" id="sponsor_logo" />
                  </div>
                  <div class="col-md-10 order-md-1 pr-md-1">
                    <div class="col-md-12 order-md-1 pr-md-5">
                      <span id="sponsor_name">
                        <b>Lim Fried Chicken</b>
                      </span>
                    </div>
                    <div class="col-md-12 order-md-1 pr-md-5">
                      <span id="sponsor_address">
                        12 Tanjong Pagar Road, 048442
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 order-md-1 pr-md-5">
              <form>
                <div class="form" id="frmbook">
                  <div class="row">
                    <div class="col-md-12 order-md-1 pr-md-5">
                      <span>
                        <h5>
                          Are you working at <b>Tan Tock Seng Hospital?</b>
                        </h5>
                      </span>
                    </div>
                  </div>
                  <div class="row" style="font-size: large;">
                    <div class="col-md-12 order-md-1 pr-md-5">
                      <div class="form-check form-check-inline">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="inlineRadioOptions"
                          id="chkyes"
                          value="option1"
                          style="transform: scale3d(1.5, 1.5, 1.5);"
                        />
                        <label class="form-check-label" for="inlineRadio1"
                          >Yes</label
                        >
                      </div>
                      <div class="form-check form-check-inline">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="inlineRadioOptions"
                          id="chkno"
                          value="option2"
                          style="transform: scale3d(1.5, 1.5, 1.5);"
                        />
                        <label class="form-check-label" for="inlineRadio2"
                          >No</label
                        >
                      </div>
                    </div>
                  </div>
                  <br />
                  <span id="formdetail">
                    <div class="row">
                      <div class="col-md-12 order-md-1 pr-md-5">
                        <span>
                          <h5>
                            <b
                              >Please enter your contact details so we can
                              register you for the food delivery:</b
                            >
                          </h5>
                        </span>
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="col-md-5 mb-3">
                        <input
                          type="text"
                          class="form-control"
                          id="full_name"
                          placeholder="Full Name"
                          required
                          name="full_name"
                        />
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="col-md-5 mb-3">
                        <input
                          type="email"
                          class="form-control"
                          id="work_email"
                          placeholder="Work Email"
                          name="work_email"
                          required
                        />
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-7 mb-3">
                        <div class="valid-feedback">
                          We ask for your work email to prevent fraud and to
                          verify that you work at this location
                        </div>
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="col-md-5 mb-3">
                        <input
                          type="number"
                          class="form-control"
                          id="phone"
                          placeholder="Mobile Phone Number"
                          name="phone"
                          required
                        />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-7 mb-3">
                        <div class="valid-feedback">
                          We ask for your mobile number to contact you when your
                          food has arrived
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 order-md-1 pr-md-5">
                        <span>
                          <h5>
                            <b>Please select the meal of your choice:</b>
                          </h5>
                        </span>
                      </div>
                    </div>
                    <span id="mealoptions"> </span>

                    <div class="row">
                      <div class="col-md-12 order-md-1 text-center pr-md-5">
                        <div class="button1">
                          <button
                            type="button"
                            class="btn btn-primary btn-lg btnall"
                            id="btnbook"
                            form="frmbook"
                          >
                            <b>Book your meal!</b>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div
                        id="msg"
                        class="alert alert-danger"
                        role="alert"
                        style="
                          color: #90010f;
                          background-color: #ffffff;
                          border-color: #ffffff;
                        "
                      ></div>
                    </div>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <br />

          <div class="row">
            <div class="col-md-12 order-md-1 pr-md-5 text-center">
              <span
                style="
                  color: #1a9cf3;
                  font-family: Arial, Helvetica, sans-serif;
                "
              >
                By booking a free meal as part of this giveaway programme, you
                hereby agree to our
                <a href="https://onpulze.com/tnc/" style="color: #1a9cf3;">
                  <b><u>Terms & Conditions</u></b></a
                >
                and
                <a href="https://onpulze.com/privacy/" style="color: #1a9cf3;">
                  <b><u>Privacy Policy</u></b></a
                >
                .A Pulze account will also be created automatically for you with
                the above details</span
              >
            </div>
          </div>
        </div>
      </main>
    </div>
    <br />
    <br />
    <%- include('layouts/footer') -%>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
      $("document").ready(function () {
        $.ajax({
          method: "GET",
          url: "/api/v1/event/" + eventid,
        }).done((d) => {
          $("#location").text(d.location);
          $("#date").text(moment(new Date(d.date)).format("LL"));
          $("#event_detail").text(d.event_detail);
          $("#sponsor_logo").attr("src", "/" + d.sponsor_logo);
          $("#sponsor_name").text(d.sponsor_name);
          $("#sponsor_address").text(d.sponsor_address);
          $.each(d.meal_option, function (i, val) {
            $("#mealoptions").append(
              `     <div class="row">
                        <div class="col-md-12 order-md-1 pr-md-5">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              id="customRadio${i}"
                              name="customRadio"
                              class="custom-control-input"
                              style="transform: scale3d(1.5, 1.5, 1.5);"
                              value="${val.text}"
                            />` +
                (val.image
                  ? `  <img
                              src="/${val.image}"
                              width="100px"
                              height="70px"
                            />&nbsp;&nbsp;`
                  : `<div></div>&nbsp;&nbsp;`) +
                `
                          
                            <label
                              class="custom-control-label"
                              for="customRadio${i}"
                              >${val.text}</label
                            >
                          </div>
                        </div>
                      </div>
                      <br />`
            );
          });
        });
        $("#formdetail").hide();
        $("#msg").hide();
        $("#frmbook").click(function () {
          $("#msg").hide();
        });
        $("#chkyes").click(function () {
          $("#formdetail").show();
        });
        $("#chkno").click(function () {
          $("#formdetail").hide();
        });
        $("#btnbook").click(function (e) {
          e.preventDefault();
          if (
            $("#full_name").val() === "" ||
            $("#work_email").val() === "" ||
            $("#phone").val() === ""
          ) {
            swal("Please enter all your contact details");
            return false;
          }

          var radioValue = $("input[name='customRadio']:checked").val();
          if (!radioValue) {
            swal("Please select preferred meal");
            return false;
          }

          let work_email = $("#work_email").val();
          let invalidEmails = [
            "@hotmail.com",
            "@yahoo.com",
            "@msn.com",
            "@outlook.com",
            "@icloud.com",
            "@aol.com",
            "@gmail.com",
          ];
          if (invalidEmails.some((v) => work_email.includes(v))) {
            swal(
              "You cannot use your personal email to book a meal. Please register with your work email"
            );
            return false;
          }
          $(this).prop("disabled", true);
          let data = {
            full_name: $("input[name='full_name']").val(),
            work_email: $("input[name='work_email']").val(),
            phone: $("input[name='phone']").val(),
            selected_meal: $("input[name='customRadio']:checked").val(),
          };

          //ajax call here
          $.ajax({
            url: "/api/v1/booking/" + eventid,
            method: "POST",
            data,
          })
            .done(function (data) {
              location.replace("/confirm/" + eventid + "/" + data.booking._id);
            })
            .fail(function (err) {
              $("#msg").html(err.responseJSON.message);
              $("#msg").show();
            });
        });
      });
    </script>
  </body>
</html>
